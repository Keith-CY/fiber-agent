(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[302],{556:(e,t,n)=>{Promise.resolve().then(n.bind(n,8118))},8250:(e,t,n)=>{"use strict";n.d(t,{Hu:()=>r,Lc:()=>i,WH:()=>d,Sj:()=>h,q0:()=>a,MO:()=>p,Bx:()=>m,Sx:()=>u});let r=null!==(l=null===(o=n.g.process)||void 0===o?void 0:o.env.CHAIN_TYPE)&&void 0!==l?l:"testnet";null===(c=n.g.process)||void 0===c||c.env.FNN_ENDPOINT,null===(s=n.g.process)||void 0===s||s.env.CKB_NODE_ENDPOINT;let a="mainnet"===r?"https://explorer.nervos.org":"https://testnet.explorer.nervos.org",i=8;var o,c,s,l,d=function(e){return e.NegotiatingFunding="NEGOTIATING_FUNDING",e.CollaboratingFundingTx="COLLABORATING_FUNDING_TX",e.SigningCommitment="SIGNING_COMMITMENT",e.AwaitingTxSignatures="AWAITING_TX_SIGNATURES",e.AwaitingChannelReady="AWAITING_CHANNEL_READY",e.ChannelReady="CHANNEL_READY",e.ShuttingDown="SHUTTING_DOWN",e.Closed="CLOSED",e}({}),h=function(e){return e.Fibb="Fibb",e.Fibt="Fibt",e.Fibd="Fibd",e}({}),u=function(e){return e.Open="Open",e.Cancelled="Cancelled",e.Expired="Expired",e.Received="Received",e.Paid="Paid",e.BeingCancelled="BeingCancelled",e.Archived="Archived",e}({}),p=function(e){return e.Account="Account",e.Peer="Peer",e.Channel="Channel",e.Merchant="Merchant",e.Invoice="Order",e}({}),m=function(e){return e.New="New",e.Delete="Delete",e.Update="Update",e.Archive="Archive",e.Cancel="Cancel",e}({})},3790:(e,t,n)=>{"use strict";n.d(t,{$Q:()=>a,ay:()=>o,w0:()=>i});var r=n(5064);let a=async()=>fetch("".concat(r.CU,"/channels")).then(e=>e.json()).then(e=>{if(e.code)throw Error(e.error);return e}),i=async(e,t)=>fetch("".concat(r.CU,"/channels/").concat(e),{method:"DELETE",body:JSON.stringify({fee_rate:t})}).then(e=>e.json()).then(e=>{if(e.code)throw Error(e.error);return e}),o=async(e,t)=>fetch("".concat(r.CU,"/channels"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({peer_id:e,funding_amount:"0x".concat(t.toString(16))})}).then(e=>e.json()).then(e=>{if(e.code)throw Error(e.error);return e})},7298:(e,t,n)=>{"use strict";n.d(t,{CF:()=>c,Do:()=>a,gS:()=>i,mo:()=>s,rw:()=>l,wP:()=>o});var r=n(5064);let a=async e=>fetch("".concat(r.CU,"/invoices?").concat(new URLSearchParams(e))).then(e=>e.json()).then(e=>{if(e.code)throw Error(e.error);return e}),i=async e=>fetch("".concat(r.CU,"/invoices/").concat(e)).then(e=>e.json()).then(e=>{if(e.code)throw Error(e.error);return e}),o=async(e,t,n,a,i,o)=>{if(!a&&!i)throw Error("Payment Preimage or order is required");return fetch("".concat(r.CU,"/invoices"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({amount:"0x".concat(e.toString(16)),description:t,currency:n,payment_preimage:a,hash_algorithm:"sha256",order:!a&&i?{merchant_id:i.merchantId,quota:i.quota,detail:i.detail}:null,udt_type_script:o})}).then(e=>e.json()).then(e=>{if(e.code)throw Error(e.error);return{code:e.code,result:{address:e.result.invoice_address,paymentHash:e.result.invoice.data.payment_hash},message:null}})},c=async e=>fetch("".concat(r.CU,"/invoices/").concat(e),{method:"DELETE"}).then(e=>e.json()).then(e=>{if(e.code)throw Error(e.error);return e}),s=async e=>fetch("".concat(r.CU,"/invoices/").concat(e),{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({action:"archive"})}).then(e=>e.json()).then(e=>{if(e.code)throw Error(e.error);return e}),l=async(e,t)=>fetch("".concat(r.CU,"/invoices/").concat(e),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({endpoint:t})}).then(e=>e.json()).then(e=>{if(e.code)throw Error(e.error);return e})},8403:(e,t,n)=>{"use strict";n.d(t,{C:()=>a,U:()=>i});var r=n(5064);let a=async()=>fetch("".concat(r.CU,"/merchants")).then(e=>e.json()).then(e=>{if(e.code)throw Error(e.error);return e}),i=async e=>fetch("".concat(r.CU,"/merchants"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{if(e.code)throw Error(e.error);return e})},6095:(e,t,n)=>{"use strict";n.d(t,{Gy:()=>a,Lc:()=>i,j1:()=>o});var r=n(5064);let a=async()=>fetch("".concat(r.CU,"/peers")).then(e=>e.json()),i=async e=>fetch("".concat(r.CU,"/peers/").concat(e),{method:"DELETE"}).then(e=>e.json()).then(e=>{if(e.code)throw Error(e.error);return e}),o=async e=>fetch("".concat(r.CU,"/peers"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({address:e})}).then(e=>e.json()).then(e=>{if(e.code)throw Error(e.error);return e})},5064:(e,t,n)=>{"use strict";n.d(t,{CU:()=>r,Lw:()=>i,a0:()=>a});let r="http://localhost:3000/api",a=1e4,i="20"},8118:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var r=n(3528),a=n(5547),i=n(8250),o=n(7298),c=n(3790),s=n(6095),l=n(8403);function d(){let{data:e,refetch:t}=(0,a.I)({queryKey:["invoices"],queryFn:()=>(0,o.Do)(),refetchInterval:1e4,refetchOnMount:!0}),{data:n,refetch:d}=(0,a.I)({queryKey:["channels"],queryFn:c.$Q,refetchInterval:1e4,refetchOnMount:!0}),{data:h,refetch:u}=(0,a.I)({queryKey:["peers"],queryFn:s.Gy,refetchInterval:1e4,refetchOnMount:!0}),{data:p,refetch:m}=(0,a.I)({queryKey:["merchants"],queryFn:l.C,refetchInterval:1e4,refetchOnMount:!0}),v=async e=>{e.stopPropagation(),e.preventDefault();let n=e.target;if(!(n instanceof HTMLButtonElement))return;let{action:r,id:a}=n.dataset;try{switch(r){case"new-merchant":{let e=window.prompt("Merchant name");if(!e)throw Error("Name is required");let t=window.prompt("Merchant description");if(!t)throw Error("description is required");let n=window.prompt("Merchant Contact");if(!n)throw Error("contact is required");let r=await (0,l.U)({name:e,description:t,contact:n});window.alert(r.message),m();return}case"new-invoice":{var i,h,p;let e=window.prompt("Amount","20000000000");if(!e)throw Error("Amount is required");let n=window.prompt("Currency","Fibt");if(!n)throw Error("Currency is required");let r=null!==(i=window.prompt("Description","description of the new invoice"))&&void 0!==i?i:"",a=window.prompt("payment preimage, leave this empty if there is an order","0x".concat(Date.now().toString()).concat("e".repeat(51))),c={merchantId:"",quota:void 0,detail:{description:""}};if(!a){let e=window.prompt("Merchant ID");if(!e)throw Error("Merchant id is required");c.merchantId=e,c.quota=null!==(h=window.prompt("Quota"))&&void 0!==h?h:void 0,c.detail.description=null!==(p=window.prompt("Product Description"))&&void 0!==p?p:""}let s=await (0,o.wP)(BigInt(e),r,n,a,c);window.alert(s.result.address),t();return}case"cancel-invoice":{if(!a||"string"!=typeof a){window.alert("Fail to get invoice id to cancel");return}let e=await (0,o.CF)(a);window.alert(e.message),t();return}case"archive-invoice":{if(!a||"string"!=typeof a){window.alert("Fail to get invoice id to cancel");return}let e=await (0,o.mo)(a);window.alert(e.message),t();return}case"open-channel":{if(!a||"string"!=typeof a){window.alert("Fail to get peer id to disconnect");return}let e=window.prompt("Funding CKB","6200000000");if(!e)return;let t=await (0,c.ay)(a,BigInt(e));window.alert(t.message),d();return}case"close-channel":{if(!a||"string"!=typeof a){window.alert("Fail to get channel id to close");return}let e=await (0,c.w0)(a,1e3);window.alert(e.message),d();return}case"connect-peer":{let e=window.prompt("P2P address of the peer","/ip4/0.0.0.0/tcp/8230/p2p/Qmcg7Du8ktQuN8pPrd4w5hni4x6dxjrp6R67LKkUK63SaV");if(!e)return;let t=await (0,s.j1)(e);window.alert(t.message),u();return}case"disconnect-peer":{if(!a||"string"!=typeof a){window.alert("Fail to get peer id to disconnect");return}let e=await (0,s.Lc)(a);window.alert(e.message),u();return}}}catch(e){e instanceof Error&&window.alert(e.message)}};return(0,r.jsx)("div",{className:"grid grid-rows-[20px_1fr_20px] items-center justify-items-center min-h-screen p-8 pb-20 gap-16 sm:p-20 font-[family-name:var(--font-geist-sans)]",children:(0,r.jsxs)("main",{className:"flex flex-col gap-8 row-start-2 items-center sm:items-start",onClick:v,children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-bold text-2xl",children:["Invoices",(0,r.jsx)("button",{"data-action":"new-invoice",children:"New Invoice"})]}),e?(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Payment Hash"}),(0,r.jsx)("th",{children:"Amount"}),(0,r.jsx)("th",{children:"Address"}),(0,r.jsx)("th",{children:"Payment Preimage"}),(0,r.jsx)("th",{children:"Description"}),(0,r.jsx)("th",{children:"Timestamp"}),(0,r.jsx)("th",{children:"Status"}),(0,r.jsx)("th",{children:"Order"}),(0,r.jsx)("th",{children:"Action"})]})}),(0,r.jsx)("tbody",{children:e.result.list.map(e=>{let t=[{key:"paymentHash",value:e.payment_hash},{key:"amount",value:e.amount},{key:"address",value:e.address},{key:"preiamge",value:e.payment_preimage},{key:"description",value:e.description},{key:"timestamp",value:e.timestamp},{key:"status",value:e.status}];return(0,r.jsxs)("tr",{children:[t.map(e=>{var t,n;return(0,r.jsx)("td",{className:"max-w-40 overflow-ellipsis overflow-hidden px-2 text-nowrap",title:null===(t=e.value)||void 0===t?void 0:t.toString(),children:null===(n=e.value)||void 0===n?void 0:n.toString()},e.key)}),(0,r.jsx)("td",{title:JSON.stringify(e.order,null,2),children:"Hover to view oder"}),e.status===i.Sx.Open?(0,r.jsx)("button",{"data-action":"cancel-invoice","data-id":e.payment_hash,children:"Cancel"}):(0,r.jsx)("button",{"data-action":"archive-invoice","data-id":e.payment_hash,children:"Archive"})]},e.payment_hash)})})]}):"Loading Invoices"]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-bold text-2xl",children:["Merchants",(0,r.jsx)("button",{"data-action":"new-merchant",children:"New Merchant"})]}),p?(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"ID"}),(0,r.jsx)("th",{children:"Name"}),(0,r.jsx)("th",{children:"Description"}),(0,r.jsx)("th",{children:"Contact"})]})}),(0,r.jsx)("tbody",{children:p.result.map(e=>{let t=[{key:"id",value:e.id},{key:"name",value:e.name},{key:"description",value:e.description},{key:"contact",value:e.contact}];return(0,r.jsx)("tr",{children:t.map(e=>{var t;return(0,r.jsx)("td",{className:"max-w-40 overflow-ellipsis overflow-hidden px-2 text-nowrap",title:null===(t=e.value)||void 0===t?void 0:t.toString(),children:e.value},e.key)})},e.id)})})]}):"Loading Invoices"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-bold text-2xl",children:"Channels"}),n?(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Channel ID"}),(0,r.jsx)("th",{children:"Peer ID"}),(0,r.jsx)("th",{children:"Token"}),(0,r.jsx)("th",{children:"Net"}),(0,r.jsx)("th",{children:"Local Balance"}),(0,r.jsx)("th",{children:"Remote Balance"}),(0,r.jsx)("th",{children:"State"}),(0,r.jsx)("th",{children:"Action"})]})}),(0,r.jsx)("tbody",{children:n.result.map(e=>{var t;let n=[{key:"id",value:e.channel_id},{key:"peerId",value:e.peer_id},{key:"token",value:null!==(t=e.funding_udt_type_script_hash)&&void 0!==t?t:"ckb"},{key:"net",value:BigInt(e.local_balance)-BigInt(e.initial_local_balance)},{key:"localBalance",value:BigInt(e.local_balance)},{key:"remoteBalance",value:BigInt(e.remote_balance)},{key:"state",value:e.state_name}];return(0,r.jsxs)("tr",{children:[n.map(e=>(0,r.jsx)("td",{className:"max-w-40 overflow-ellipsis overflow-hidden px-2 text-nowrap",title:e.value.toString(),children:e.value},e.key)),(0,r.jsx)("td",{children:e.state_name===i.WH.ChannelReady?(0,r.jsx)("button",{"data-action":"close-channel","data-id":e.channel_id,children:"Close"}):null})]},e.channel_id)})})]}):"Loading Channels"]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-bold text-2xl",children:["Peers",(0,r.jsx)("button",{"data-action":"connect-peer",children:"Connect a Peer"})]}),h?(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Is Local"}),(0,r.jsx)("th",{children:"Peer ID"}),(0,r.jsx)("th",{children:"Status"}),(0,r.jsx)("th",{children:"Channels"}),(0,r.jsx)("th",{children:"Action"})]})}),(0,r.jsx)("tbody",{children:h.result.map(e=>{var t;let n=[{key:"isLocal",value:e.is_local.toString()},{key:"peerId",value:e.peer_id},{key:"status",value:e.network_sync_status},{key:"channels",value:+(null!==(t=e.channel_count)&&void 0!==t?t:0)}];return(0,r.jsxs)("tr",{children:[n.map(e=>{var t,n;return(0,r.jsx)("td",{className:"max-w-40 overflow-ellipsis overflow-hidden px-2 text-nowrap",title:null===(t=e.value)||void 0===t?void 0:t.toString(),children:null!==(n=e.value)&&void 0!==n?n:""},e.key)}),(0,r.jsx)("td",{children:e.is_local?null:(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("button",{"data-action":"disconnect-peer","data-id":e.peer_id,children:"Disconnect"}),(0,r.jsx)("button",{"data-action":"open-channel","data-id":e.peer_id,children:"Open Channel"})]})})]},e.peer_id)})})]}):"Loading Peers"]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[356,928,465,743,358],()=>t(556)),_N_E=e.O()}]);